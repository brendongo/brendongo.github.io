<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
    <title>Nightmare Psychiatry Quiz üéÉ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: rgba(255, 94, 0, 0.2);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            padding-top: max(20px, env(safe-area-inset-top));
            padding-right: max(20px, env(safe-area-inset-right));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
            padding-left: max(20px, env(safe-area-inset-left));
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 94, 0, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(138, 43, 226, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 0, 0, 0.1) 0%, transparent 40%),
                linear-gradient(180deg, #0a0a0a 0%, #1a0f1f 50%, #2a1a3a 100%);
            animation: spookyPulse 8s ease-in-out infinite;
        }

        @keyframes spookyPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .quiz-container {
            background: linear-gradient(145deg, rgba(20, 10, 30, 0.95), rgba(40, 20, 50, 0.95));
            border: 2px solid rgba(255, 94, 0, 0.3);
            border-radius: 20px;
            padding: 50px;
            max-width: 1200px;
            width: 100%;
            box-shadow: 
                0 20px 60px rgba(255, 94, 0, 0.2),
                0 0 100px rgba(138, 43, 226, 0.1),
                inset 0 0 20px rgba(255, 94, 0, 0.05);
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1;
        }

        .quiz-container::before {
            content: "ü¶á";
            position: absolute;
            top: -20px;
            left: 30px;
            font-size: 40px;
            animation: float 3s ease-in-out infinite;
        }

        .quiz-container::after {
            content: "üëª";
            position: absolute;
            top: -20px;
            right: 30px;
            font-size: 40px;
            animation: float 3s ease-in-out infinite 0.5s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .progress-bar {
            height: 10px;
            background: rgba(50, 25, 70, 0.7);
            border-radius: 5px;
            margin-bottom: 40px;
            overflow: hidden;
            border: 1px solid rgba(255, 94, 0, 0.2);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff5e00, #ff9500, #ff5e00);
            border-radius: 3px;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 94, 0, 0.6);
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 94, 0, 0.6); }
            50% { box-shadow: 0 0 20px rgba(255, 94, 0, 0.9); }
        }

        .question-number {
            color: #ff9500;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 149, 0, 0.5);
        }

        .difficulty-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            margin-left: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: flicker 3s infinite;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .difficulty-easy {
            background: linear-gradient(135deg, #50c878, #228b22);
            color: white;
            box-shadow: 0 0 15px rgba(80, 200, 120, 0.5);
        }

        .difficulty-medium {
            background: linear-gradient(135deg, #ffa500, #ff8c00);
            color: white;
            box-shadow: 0 0 15px rgba(255, 165, 0, 0.5);
        }

        .difficulty-hard {
            background: linear-gradient(135deg, #8b0000, #dc143c);
            color: white;
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.5);
        }

        .question {
            font-size: 28px;
            font-weight: 700;
            color: #f8f8f8;
            margin-bottom: 40px;
            line-height: 1.5;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .option {
            padding: 20px 30px;
            background: linear-gradient(135deg, rgba(40, 20, 60, 0.7), rgba(60, 30, 80, 0.7));
            border: 2px solid rgba(138, 43, 226, 0.3);
            border-radius: 12px;
            font-size: 19px;
            color: #e0e0e0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            touch-action: manipulation;
            will-change: transform;
        }

        .option:hover:not(.correct):not(.incorrect):not(.disabled) {
            border-color: rgba(255, 94, 0, 0.5);
            background: linear-gradient(135deg, rgba(50, 25, 70, 0.8), rgba(70, 35, 90, 0.8));
            transform: translateX(5px);
            box-shadow: 0 0 20px rgba(255, 94, 0, 0.2);
        }

        .option:active:not(.correct):not(.incorrect):not(.disabled) {
            border-color: rgba(255, 94, 0, 0.7);
            background: linear-gradient(135deg, rgba(60, 30, 80, 0.9), rgba(80, 40, 100, 0.9));
            transform: translateX(5px) scale(0.98);
            box-shadow: 0 0 25px rgba(255, 94, 0, 0.4);
        }

        .option.disabled {
            pointer-events: none;
            opacity: 0.5;
        }

        .option.correct {
            background: linear-gradient(135deg, #50c878, #228b22);
            color: white;
            border-color: #50c878;
            animation: correctPulse 0.5s ease;
            box-shadow: 0 0 30px rgba(80, 200, 120, 0.6);
        }

        .option.incorrect {
            background: linear-gradient(135deg, #8b0000, #4b0000);
            color: #ff9999;
            border-color: #8b0000;
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .answer-reveal {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(50, 25, 70, 0.9), rgba(70, 35, 90, 0.9));
            border-radius: 12px;
            border-left: 4px solid #ff5e00;
            border: 2px solid rgba(255, 94, 0, 0.3);
            opacity: 0;
            transform: translateY(20px);
            animation: slideIn 0.5s ease forwards;
            box-shadow: 0 0 20px rgba(255, 94, 0, 0.2);
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .answer-label {
            font-size: 14px;
            font-weight: 600;
            color: #ff9500;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 149, 0, 0.5);
        }

        .answer-text {
            font-size: 18px;
            color: #e0e0e0;
            font-weight: 500;
            line-height: 1.6;
        }

        .click-hint {
            text-align: center;
            margin-top: 30px;
            font-size: 15px;
            color: #ff9500;
            font-style: italic;
            opacity: 0;
            animation: fadeIn 0.5s ease 0.5s forwards;
            text-shadow: 0 0 5px rgba(255, 149, 0, 0.3);
        }

        .quiz-complete {
            text-align: center;
            animation: slideIn 0.5s ease;
        }

        .quiz-complete h2 {
            font-family: 'Creepster', cursive;
            font-size: 48px;
            color: #ff5e00;
            margin-bottom: 25px;
            text-shadow: 0 0 20px rgba(255, 94, 0, 0.8);
            animation: spookyGlow 2s ease-in-out infinite;
            letter-spacing: 3px;
        }

        @keyframes spookyGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 94, 0, 0.8); }
            50% { text-shadow: 0 0 30px rgba(255, 94, 0, 1); }
        }

        .score {
            font-size: 64px;
            font-weight: 700;
            background: linear-gradient(135deg, #ff5e00, #ff9500, #ff5e00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            animation: spookyGlow 2s ease-in-out infinite;
        }

        .score-breakdown {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .score-item {
            text-align: center;
            padding: 20px;
            background: rgba(50, 25, 70, 0.5);
            border-radius: 10px;
            border: 1px solid rgba(255, 94, 0, 0.3);
        }

        .score-label {
            font-size: 14px;
            color: #ff9500;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .score-value {
            font-size: 32px;
            font-weight: 600;
            color: #f8f8f8;
            text-shadow: 0 0 10px rgba(255, 149, 0, 0.3);
        }

        .restart-btn {
            padding: 18px 50px;
            background: linear-gradient(135deg, #ff5e00, #ff7300);
            color: white;
            border: 2px solid rgba(255, 94, 0, 0.5);
            border-radius: 30px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            box-shadow: 0 5px 20px rgba(255, 94, 0, 0.4);
            touch-action: manipulation;
            will-change: transform;
        }

        .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 94, 0, 0.6);
            background: linear-gradient(135deg, #ff7300, #ff9500);
        }

        .restart-btn:active {
            transform: translateY(-1px) scale(0.98);
            box-shadow: 0 5px 20px rgba(255, 94, 0, 0.5);
        }

        .spider {
            position: fixed;
            top: 10%;
            right: 5%;
            font-size: 30px;
            animation: floatGhost 10s ease-in-out infinite;
            z-index: 0;
            opacity: 0.3;
        }

        @keyframes floatGhost {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(5deg); }
            66% { transform: translate(-20px, 20px) rotate(-5deg); }
        }

        /* Popup Modal */
        .popup-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #8b0000, #dc143c);
            border: 3px solid #ff0000;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.8);
            animation: popupAppear 0.5s ease forwards;
        }

        .popup-modal.popup-correct {
            background: linear-gradient(135deg, #50c878, #228b22);
            border: 3px solid #50c878;
            box-shadow: 0 0 50px rgba(80, 200, 120, 0.8);
        }

        .popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 44px;
            height: 44px;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            transition: all 0.2s ease;
            line-height: 1;
        }

        .popup-close:hover {
            background: rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.8);
            transform: scale(1.1);
        }

        .popup-close:active {
            background: rgba(0, 0, 0, 0.7);
            border-color: rgba(255, 255, 255, 1);
            transform: scale(0.95);
        }

        @keyframes popupAppear {
            to {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .popup-modal h3 {
            font-family: 'Creepster', cursive;
            font-size: 42px;
            color: white;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            letter-spacing: 2px;
        }

        .popup-correct h3 {
            font-size: 32px;
        }

        .popup-modal .emoji {
            font-size: 80px;
            margin-bottom: 20px;
            animation: rotate 1s ease-in-out infinite;
        }

        @keyframes rotate {
            0%, 100% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }

        /* Responsive Media Queries for iPad/Mobile */
        @media (max-width: 768px) {
            .quiz-container {
                padding: 20px;
                max-width: 100%;
            }

            .quiz-container::before,
            .quiz-container::after {
                font-size: 30px;
                top: -15px;
            }

            .quiz-container::before {
                left: 15px;
            }

            .quiz-container::after {
                right: 15px;
            }

            .question {
                font-size: 22px;
                margin-bottom: 30px;
            }

            .option {
                padding: 16px 20px;
                font-size: 17px;
            }

            .quiz-complete h2 {
                font-size: 36px;
            }

            .score {
                font-size: 48px;
            }

            .score-breakdown {
                flex-direction: column;
                gap: 15px;
            }

            .score-item {
                padding: 15px;
            }

            .restart-btn {
                padding: 15px 40px;
                font-size: 18px;
            }

            .popup-modal {
                padding: 30px 20px;
                width: 90%;
                max-width: 400px;
            }

            .popup-modal h3 {
                font-size: 28px;
            }

            .popup-correct h3 {
                font-size: 24px;
            }

            .popup-modal .emoji {
                font-size: 60px;
            }

            .spider {
                font-size: 24px;
                top: 5%;
                right: 3%;
            }
        }

        @media (max-width: 480px) {
            .quiz-container {
                padding: 15px;
            }

            .question {
                font-size: 20px;
            }

            .option {
                padding: 14px 18px;
                font-size: 16px;
            }

            .quiz-complete h2 {
                font-size: 28px;
            }

            .score {
                font-size: 40px;
            }

            .restart-btn {
                padding: 12px 30px;
                font-size: 16px;
            }

            .popup-modal h3 {
                font-size: 24px;
            }

            .popup-correct h3 {
                font-size: 20px;
            }

            .popup-modal .emoji {
                font-size: 50px;
            }
        }

        /* iPad specific optimizations */
        @media (min-width: 768px) and (max-width: 1024px) {
            .quiz-container {
                padding: 35px;
            }

            .question {
                font-size: 26px;
            }

            .option {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="spider">üï∑Ô∏è</div>
    <div class="quiz-container" id="quizContainer">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div id="quizContent"></div>
    </div>

    <script>
                const hardQuestions = [
            {
                question: "CYP2D6 ultra-rapid metabolizer with treatment-resistant depression. Best medication choice?",
                options: [
                    "Fluoxetine",
                    "Lithium augmentation",
                    "Tranylcypromine",
                    "Desvenlafaxine",
                    "Esketamine",
                    "Modafinil",
                ],
                correct: 3,
                explanation: "Desvenlafaxine bypasses CYP2D6 metabolism, making it ideal for ultra-rapid metabolizers.",
                difficulty: "hard"
            },
            {
                question: "Lithium-induced nephrogenic diabetes insipidus with rising creatinine. Best intervention?",
                options: [
                    "Add hydrochlorothiazide",
                    "Switch to valproate",
                    "Switch to carbamazepine",
                    "Add desmopressin",
                    "Add amiloride",
                    "Add lamotrigine",
                ],
                correct: 4,
                explanation: "Amiloride blocks ENaC channels, preventing lithium reabsorption while maintaining mood stabilization.",
                difficulty: "hard"
            },
            {
                question: "Acute psychosis with temporal lobe MRI changes and CSF pleocytosis. Most likely antibody?",
                options: [
                    "Anti-AMPA receptor",
                    "Anti-LGI1",
                    "Anti-GAD65",
                    "Anti-NMDA receptor",
                    "Anti-Hu",
                    "Anti-VGKC",
                ],
                correct: 3,
                explanation: "Anti-NMDA receptor encephalitis presents with psychiatric symptoms before neurological signs.",
                difficulty: "hard"
            },
            {
                question: "Antipsychotic trial: NNT=7, NNH for weight gain=9, NNH for QTc=142. Interpretation?",
                options: [
                    "Drug ineffective",
                    "Avoid due to cardiac risk",
                    "Benefits outweigh risks",
                    "Unfavorable risk-benefit",
                    "Non-significant results",
                    "Weight gain exceeds benefit",
                ],
                correct: 2,
                explanation: "NNT of 7 shows moderate efficacy. Weight gain manageable, QTc risk minimal. Benefits outweigh risks.",
                difficulty: "hard"
            },
            {
                question: "Clozapine patient: fever, tachycardia, CK 890. Best test for NMS vs myocarditis?",
                options: [
                    "Iron/ferritin",
                    "Troponin/BNP",
                    "EEG",
                    "Repeat CK",
                    "Dantrolene test",
                    "Echo/cardiac MRI",
                ],
                correct: 1,
                explanation: "Troponin and BNP specifically elevated in myocarditis but not NMS.",
                difficulty: "hard"
            },
            {
                question: "PTSD relapse after successful CPT. Expected neuroimaging pattern?",
                options: [
                    "‚Üë dorsal ACC, ‚Üì amygdala",
                    "‚Üë amygdala, ‚Üì vmPFC",
                    "‚Üì amygdala and PFC",
                    "‚Üë hippocampus-PCC connectivity",
                    "‚Üë anterior insula only",
                    "‚Üë bilateral hippocampus",
                ],
                correct: 1,
                explanation: "PTSD relapse shows amygdala hyperactivity with vmPFC hypoactivity (impaired fear extinction).",
                difficulty: "hard"
            },
            {
                question: "Mechanism of ketamine's rapid antidepressant effect?",
                options: [
                    "Sigma-1 receptor agonism",
                    "Dopamine reuptake inhibition",
                    "5-HT2A agonism",
                    "NMDA antagonism ‚Üí BDNF/mTOR",
                    "GABA-A potentiation",
                    "Norepinephrine release",
                ],
                correct: 3,
                explanation: "Ketamine blocks NMDA receptors, increasing BDNF and activating mTOR pathway for synaptogenesis.",
                difficulty: "hard"
            },
            {
                question: "Best predictor of lithium response in bipolar disorder?",
                options: [
                    "Comorbid anxiety",
                    "Substance use disorder",
                    "Psychotic features",
                    "Mixed episodes",
                    "Family history of lithium response",
                    "Rapid cycling pattern",
                ],
                correct: 4,
                explanation: "Family history of lithium response is the strongest predictor of treatment success.",
                difficulty: "hard"
            },
            {
                question: "Patient on MAOIs presents with hypertensive crisis. Immediate treatment?",
                options: [
                    "IV phentolamine",
                    "Sublingual nifedipine",
                    "Oral clonidine",
                    "IV hydralazine",
                    "IV nitroprusside",
                    "IV labetalol",
                ],
                correct: 0,
                explanation: "Phentolamine (alpha-blocker) is first-line for MAOI-induced hypertensive crisis.",
                difficulty: "hard"
            },
            {
                question: "Which receptor polymorphism predicts antipsychotic-induced hyperprolactinemia?",
                options: [
                    "DRD3 Ser9Gly",
                    "COMT Val158Met",
                    "5-HT2A C102T",
                    "5-HT2C -759C/T",
                    "DRD2 Taq1A",
                    "ABCB1 C3435T",
                ],
                correct: 4,
                explanation: "DRD2 Taq1A polymorphism affects D2 receptor density and prolactin response.",
                difficulty: "hard"
            },
            {
                question: "Catatonia in adolescent with normal EEG. First-line treatment after lorazepam fails?",
                options: [
                    "Haloperidol",
                    "Amantadine",
                    "ECT",
                    "Memantine",
                    "Dantrolene",
                    "Bromocriptine",
                ],
                correct: 2,
                explanation: "ECT is the definitive treatment for benzodiazepine-resistant catatonia.",
                difficulty: "hard"
            },
            {
                question: "HLA-B*1502 screening before starting which medication?",
                options: [
                    "Carbamazepine",
                    "Gabapentin",
                    "Topiramate",
                    "Lamotrigine",
                    "Valproate",
                    "Lithium",
                ],
                correct: 0,
                explanation: "HLA-B*1502 screening required for carbamazepine due to Stevens-Johnson syndrome risk in Asians.",
                difficulty: "hard"
            },
            {
                question: "Methylphenidate contraindicated due to risk of sudden death in which condition?",
                options: [
                    "Anxiety disorders",
                    "History of seizures",
                    "Glaucoma",
                    "Structural cardiac abnormalities",
                    "Tourette syndrome",
                    "Bipolar disorder",
                ],
                correct: 3,
                explanation: "Structural cardiac abnormalities increase sudden death risk with stimulants.",
                difficulty: "hard"
            },
            {
                question: "Best evidence-based psychotherapy for borderline personality disorder?",
                options: [
                    "CBT",
                    "Psychodynamic therapy",
                    "EMDR",
                    "IPT",
                    "DBT",
                    "Supportive therapy",
                ],
                correct: 4,
                explanation: "DBT has the strongest evidence base for reducing self-harm and suicidality in BPD.",
                difficulty: "hard"
            },
            {
                question: "Cerebellar cognitive affective syndrome most likely after stroke in which area?",
                options: [
                    "Anterior lobe",
                    "Superior peduncle",
                    "Deep nuclei",
                    "Flocculonodular lobe",
                    "Posterior lobe",
                    "Vermis",
                ],
                correct: 4,
                explanation: "Posterior lobe lesions cause cognitive/emotional symptoms (executive dysfunction, affect dysregulation).",
                difficulty: "hard"
            },
            {
                question: "Clock drawing test score of 2/10 suggests dysfunction in which brain region?",
                options: [
                    "Occipital lobe",
                    "Parietal lobe",
                    "Frontal lobe",
                    "Cerebellum",
                    "Temporal lobe",
                    "Basal ganglia",
                ],
                correct: 1,
                explanation: "Clock drawing primarily tests parietal lobe function (visuospatial processing).",
                difficulty: "hard"
            },
            {
                question: "Antidepressant most likely to cause SIADH in elderly?",
                options: [
                    "Vortioxetine",
                    "Bupropion",
                    "Vilazodone",
                    "Escitalopram",
                    "Mirtazapine",
                    "Nortriptyline",
                ],
                correct: 3,
                explanation: "SSRIs, especially escitalopram, have highest SIADH risk in elderly patients.",
                difficulty: "hard"
            },
            {
                question: "P300 amplitude reduction most associated with which condition?",
                options: [
                    "OCD",
                    "Major depression",
                    "Bipolar disorder",
                    "Schizophrenia",
                    "PTSD",
                    "Panic disorder",
                ],
                correct: 3,
                explanation: "P300 amplitude reduction is a robust finding in schizophrenia, reflecting cognitive deficits.",
                difficulty: "hard"
            },
            {
                question: "Which medication requires slow titration due to risk of aseptic meningitis?",
                options: [
                    "Carbamazepine",
                    "Oxcarbazepine",
                    "Topiramate",
                    "Lamotrigine",
                    "Valproate",
                    "Lithium",
                ],
                correct: 3,
                explanation: "Lamotrigine can cause aseptic meningitis if titrated too quickly.",
                difficulty: "hard"
            },
            {
                question: "Biomarker most specific for Alzheimer's vs other dementias?",
                options: [
                    "Tau protein",
                    "14-3-3 protein",
                    "GFAP",
                    "AŒ≤42/AŒ≤40 ratio",
                    "Neurofilament light",
                    "S100B",
                ],
                correct: 3,
                explanation: "AŒ≤42/AŒ≤40 ratio in CSF/plasma is most specific for Alzheimer's pathology.",
                difficulty: "hard"
            },
            {
                question: "Orexin/hypocretin deficiency causes which disorder?",
                options: [
                    "Kleine-Levin syndrome",
                    "Restless legs syndrome",
                    "Narcolepsy type 1",
                    "Fatal familial insomnia",
                    "REM sleep behavior disorder",
                    "Sleep apnea",
                ],
                correct: 2,
                explanation: "Narcolepsy type 1 is caused by loss of orexin/hypocretin neurons in hypothalamus.",
                difficulty: "hard"
            },
            {
                question: "Best treatment for neuroleptic-induced akathisia?",
                options: [
                    "Diphenhydramine",
                    "Amantadine",
                    "Benztropine",
                    "Vitamin E",
                    "Propranolol",
                    "Lorazepam",
                ],
                correct: 4,
                explanation: "Beta-blockers like propranolol are first-line for akathisia (anticholinergics ineffective).",
                difficulty: "hard"
            },
            {
                question: "Transcranial magnetic stimulation FDA-approved target for depression?",
                options: [
                    "Supplementary motor area",
                    "Left VMPFC",
                    "Bilateral DLPFC",
                    "Right parietal",
                    "Right DLPFC",
                    "Left DLPFC",
                ],
                correct: 5,
                explanation: "Left dorsolateral prefrontal cortex is the FDA-approved TMS target for depression.",
                difficulty: "hard"
            },
            {
                question: "Which atypical antipsychotic has highest D2 receptor occupancy at therapeutic doses?",
                options: [
                    "Aripiprazole",
                    "Quetiapine",
                    "Risperidone",
                    "Olanzapine",
                    "Clozapine",
                    "Ziprasidone",
                ],
                correct: 2,
                explanation: "Risperidone has highest D2 occupancy (>70%) at therapeutic doses among atypicals.",
                difficulty: "hard"
            },
            {
                question: "Fragile X premutation carriers at risk for which late-onset syndrome?",
                options: [
                    "Multiple system atrophy",
                    "Frontotemporal dementia",
                    "FXTAS",
                    "Corticobasal degeneration",
                    "Progressive supranuclear palsy",
                    "Lewy body dementia",
                ],
                correct: 2,
                explanation: "Fragile X-associated tremor/ataxia syndrome (FXTAS) occurs in premutation carriers.",
                difficulty: "hard"
            },
            {
                question: "Memantine mechanism in Alzheimer's treatment?",
                options: [
                    "GABA potentiation",
                    "Tau stabilization",
                    "Amyloid clearance",
                    "NMDA antagonism",
                    "Acetylcholinesterase inhibition",
                    "Serotonin modulation",
                ],
                correct: 3,
                explanation: "Memantine is an uncompetitive NMDA receptor antagonist, reducing excitotoxicity.",
                difficulty: "hard"
            },
            {
                question: "Most sensitive early marker of lithium nephrotoxicity?",
                options: [
                    "eGFR",
                    "Urine specific gravity",
                    "24-hour urine protein",
                    "Cystatin C",
                    "Urine albumin/creatinine ratio",
                    "Serum creatinine",
                ],
                correct: 4,
                explanation: "Urine albumin/creatinine ratio detects early tubular damage before creatinine rises.",
                difficulty: "hard"
            },
            {
                question: "Pimavanserin approved for treating psychosis in which condition?",
                options: [
                    "Parkinson's disease",
                    "Lewy body dementia",
                    "Bipolar disorder",
                    "Delirium",
                    "Schizophrenia",
                    "Alzheimer's disease",
                ],
                correct: 0,
                explanation: "Pimavanserin (5-HT2A inverse agonist) is FDA-approved for Parkinson's disease psychosis.",
                difficulty: "hard"
            },
            {
                question: "CYP3A4 inhibitor causing dangerous interaction with quetiapine?",
                options: [
                    "Duloxetine",
                    "Sertraline",
                    "Bupropion",
                    "Fluoxetine",
                    "Ketoconazole",
                    "Citalopram",
                ],
                correct: 4,
                explanation: "Ketoconazole strongly inhibits CYP3A4, dramatically increasing quetiapine levels.",
                difficulty: "hard"
            },
            {
                question: "Gene most strongly associated with treatment-resistant schizophrenia?",
                options: [
                    "C4A",
                    "DISC1",
                    "NRG1",
                    "DRD2",
                    "CACNA1C",
                    "COMT",
                ],
                correct: 0,
                explanation: "C4A (complement component 4A) overexpression strongly linked to treatment resistance.",
                difficulty: "hard"
            }
        ];

        const easyQuestions = [
            {
                question: "First-line medication for major depressive disorder?",
                options: [
                    "Methylphenidate",
                    "Haloperidol",
                    "Lithium",
                    "Sertraline",
                    "Lorazepam",
                    "Buspirone",
                ],
                correct: 3,
                explanation: "SSRIs like sertraline are first-line treatments for major depression.",
                difficulty: "easy"
            },
            {
                question: "Hallmark symptom of schizophrenia?",
                options: [
                    "Hallucinations",
                    "Phobias",
                    "Memory loss",
                    "Hyperactivity",
                    "Mood swings",
                    "Compulsions",
                ],
                correct: 0,
                explanation: "Hallucinations, especially auditory, are hallmark positive symptoms of schizophrenia.",
                difficulty: "easy"
            },
            {
                question: "Duration criterion for major depressive episode?",
                options: [
                    "6 months",
                    "1 month",
                    "1 week",
                    "1 year",
                    "2 weeks",
                    "2 months",
                ],
                correct: 4,
                explanation: "Major depressive episode requires symptoms for at least 2 weeks.",
                difficulty: "easy"
            },
            {
                question: "Neurotransmitter primarily involved in depression?",
                options: [
                    "Histamine",
                    "Melatonin",
                    "Acetylcholine",
                    "Glycine",
                    "Serotonin",
                    "Adenosine",
                ],
                correct: 4,
                explanation: "Serotonin deficiency is the classic monoamine hypothesis of depression.",
                difficulty: "easy"
            },
            {
                question: "Most common side effect of SSRIs?",
                options: [
                    "Hair loss",
                    "GI disturbance",
                    "Weight loss",
                    "Tremor",
                    "Hypertension",
                    "Confusion",
                ],
                correct: 1,
                explanation: "Gastrointestinal side effects (nausea, diarrhea) are most common with SSRIs.",
                difficulty: "easy"
            },
            {
                question: "Treatment for acute anxiety/panic attack?",
                options: [
                    "Antihistamine",
                    "Beta blocker",
                    "Mood stabilizer",
                    "Antipsychotic",
                    "Benzodiazepine",
                    "Stimulant",
                ],
                correct: 4,
                explanation: "Benzodiazepines provide rapid relief for acute anxiety and panic attacks.",
                difficulty: "easy"
            },
            {
                question: "Manic episode duration requirement?",
                options: [
                    "14 days",
                    "21 days",
                    "30 days",
                    "7 days",
                    "4 days",
                    "2 days",
                ],
                correct: 3,
                explanation: "Manic episode requires symptoms for at least 7 days (or any duration if hospitalized).",
                difficulty: "easy"
            },
            {
                question: "Gold standard treatment for bipolar disorder?",
                options: [
                    "Stimulants",
                    "Antidepressants",
                    "Antipsychotics",
                    "Benzodiazepines",
                    "Lithium",
                    "Anticonvulsants",
                ],
                correct: 4,
                explanation: "Lithium remains the gold standard mood stabilizer for bipolar disorder.",
                difficulty: "easy"
            },
            {
                question: "Core feature of ADHD?",
                options: [
                    "Depression",
                    "Mania",
                    "Inattention",
                    "Obsessions",
                    "Delusions",
                    "Hallucinations",
                ],
                correct: 2,
                explanation: "Inattention is a core feature of ADHD (along with hyperactivity/impulsivity).",
                difficulty: "easy"
            },
            {
                question: "First-line therapy for PTSD?",
                options: [
                    "Group therapy",
                    "Psychoanalysis",
                    "Music therapy",
                    "Trauma-focused CBT",
                    "Art therapy",
                    "Hypnotherapy",
                ],
                correct: 3,
                explanation: "Trauma-focused CBT is first-line psychotherapy for PTSD.",
                difficulty: "easy"
            },
            {
                question: "What class of medication is diazepam?",
                options: [
                    "TCA",
                    "Benzodiazepine",
                    "SNRI",
                    "MAOI",
                    "Antipsychotic",
                    "SSRI",
                ],
                correct: 1,
                explanation: "Diazepam (Valium) is a benzodiazepine used for anxiety and seizures.",
                difficulty: "easy"
            },
            {
                question: "Primary symptom of panic disorder?",
                options: [
                    "Mood swings",
                    "Persistent sadness",
                    "Recurrent panic attacks",
                    "Chronic worry",
                    "Flashbacks",
                    "Social avoidance",
                ],
                correct: 2,
                explanation: "Panic disorder is characterized by recurrent, unexpected panic attacks.",
                difficulty: "easy"
            },
            {
                question: "Which symptom is NOT part of depression?",
                options: [
                    "Insomnia",
                    "Flight of ideas",
                    "Guilt",
                    "Poor concentration",
                    "Fatigue",
                    "Anhedonia",
                ],
                correct: 1,
                explanation: "Flight of ideas is a manic symptom, not a depressive symptom.",
                difficulty: "easy"
            },
            {
                question: "Treatment for alcohol withdrawal?",
                options: [
                    "Antipsychotics",
                    "Anticholinergics",
                    "Benzodiazepines",
                    "SSRIs",
                    "Stimulants",
                    "Opioids",
                ],
                correct: 2,
                explanation: "Benzodiazepines prevent seizures and treat alcohol withdrawal symptoms.",
                difficulty: "easy"
            },
            {
                question: "Age of onset typically for schizophrenia in males?",
                options: [
                    "18-25 years",
                    "50-60 years",
                    "10-15 years",
                    "40-50 years",
                    "30-40 years",
                    "5-10 years",
                ],
                correct: 0,
                explanation: "Schizophrenia typically onset in late teens to mid-twenties for males.",
                difficulty: "easy"
            }
        ];

        const mediumQuestions = [
            {
                question: "Antidepressant with lowest risk of sexual dysfunction?",
                options: [
                    "Paroxetine",
                    "Bupropion",
                    "Venlafaxine",
                    "Sertraline",
                    "Citalopram",
                    "Fluoxetine",
                ],
                correct: 1,
                explanation: "Bupropion (dopamine/norepinephrine reuptake inhibitor) has minimal sexual side effects.",
                difficulty: "medium"
            },
            {
                question: "First-rank symptom of schizophrenia?",
                options: [
                    "Concrete thinking",
                    "Poor hygiene",
                    "Thought broadcasting",
                    "Flat affect",
                    "Ambivalence",
                    "Social withdrawal",
                ],
                correct: 2,
                explanation: "Thought broadcasting is a Schneiderian first-rank symptom of schizophrenia.",
                difficulty: "medium"
            },
            {
                question: "Black box warning for all antidepressants?",
                options: [
                    "Cardiac arrhythmias",
                    "Serotonin syndrome",
                    "Suicidality in young adults",
                    "Tardive dyskinesia",
                    "Stevens-Johnson syndrome",
                    "Hepatotoxicity",
                ],
                correct: 2,
                explanation: "FDA black box warning for increased suicidal thoughts in patients under 25.",
                difficulty: "medium"
            },
            {
                question: "Which antipsychotic has highest weight gain risk?",
                options: [
                    "Paliperidone",
                    "Ziprasidone",
                    "Haloperidol",
                    "Aripiprazole",
                    "Lurasidone",
                    "Olanzapine",
                ],
                correct: 5,
                explanation: "Olanzapine causes the most weight gain among antipsychotics.",
                difficulty: "medium"
            },
            {
                question: "Lab monitoring required for clozapine?",
                options: [
                    "Thyroid function",
                    "Prolactin level",
                    "Absolute neutrophil count",
                    "Platelet count",
                    "Creatinine",
                    "Liver function",
                ],
                correct: 2,
                explanation: "ANC monitoring required due to agranulocytosis risk with clozapine.",
                difficulty: "medium"
            },
            {
                question: "Difference between bipolar I and bipolar II?",
                options: [
                    "Duration of episodes",
                    "Psychotic features",
                    "Response to lithium",
                    "Presence of full manic episode",
                    "Gender distribution",
                    "Age of onset",
                ],
                correct: 3,
                explanation: "Bipolar I requires at least one full manic episode; bipolar II has hypomania only.",
                difficulty: "medium"
            },
            {
                question: "SSRI discontinuation syndrome characterized by?",
                options: [
                    "Catatonia",
                    "Brain zaps and flu-like symptoms",
                    "Psychosis",
                    "Mania",
                    "Hypertension",
                    "Seizures",
                ],
                correct: 1,
                explanation: "SSRI discontinuation causes 'brain zaps,' dizziness, and flu-like symptoms.",
                difficulty: "medium"
            },
            {
                question: "Which medication is contraindicated with MAOIs?",
                options: [
                    "Aspirin",
                    "Gabapentin",
                    "Acetaminophen",
                    "Meperidine",
                    "Propranolol",
                    "Lorazepam",
                ],
                correct: 3,
                explanation: "Meperidine with MAOIs can cause fatal serotonin syndrome.",
                difficulty: "medium"
            },
            {
                question: "Negative symptom of schizophrenia?",
                options: [
                    "Hallucinations",
                    "Delusions",
                    "Catatonia",
                    "Agitation",
                    "Disorganized speech",
                    "Alogia",
                ],
                correct: 5,
                explanation: "Alogia (poverty of speech) is a negative symptom of schizophrenia.",
                difficulty: "medium"
            },
            {
                question: "Therapeutic lithium level range?",
                options: [
                    "1.5-2.0 mEq/L",
                    "1.2-1.5 mEq/L",
                    "0.6-1.2 mEq/L",
                    "0.2-0.4 mEq/L",
                    "2.0-2.5 mEq/L",
                    "0.1-0.3 mEq/L",
                ],
                correct: 2,
                explanation: "Therapeutic lithium level is 0.6-1.2 mEq/L for most patients.",
                difficulty: "medium"
            }
        ];

        // Audio context for buzzer sound
        let audioContext;
        let audioInitialized = false;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            // Resume audio context for iOS Safari
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            audioInitialized = true;
        }

        function playBuzzer() {
            if (!audioInitialized) {
                initAudio();
            }
            
            // Create 3 quick buzzes for alarm effect
            for (let i = 0; i < 3; i++) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'square';
                oscillator.frequency.value = 120;
                
                const startTime = audioContext.currentTime + (i * 0.15);
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(0.3, startTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(0.3, startTime + 0.08);
                gainNode.gain.linearRampToValueAtTime(0, startTime + 0.1);
                
                oscillator.start(startTime);
                oscillator.stop(startTime + 0.1);
            }
        }

        function playSuccess() {
            if (!audioInitialized) {
                initAudio();
            }
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800; // Higher frequency for success
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // Seeded random number generator for stable shuffling
        function seededRandom(seed) {
            let state = seed;
            return function() {
                state = (state * 1664525 + 1013904223) % 4294967296;
                return state / 4294967296;
            };
        }

        // Combine and shuffle questions at startup
        let questions = [];

        function initializeQuestions() {
            questions = [...hardQuestions, ...easyQuestions, ...mediumQuestions];

            // Use a fixed seed for stable shuffling (you can change this seed to get different orders)
            const seed = 44;
            const random = seededRandom(seed);

            // Fisher-Yates shuffle with seeded random
            for (let i = questions.length - 1; i > 0; i--) {
                const j = Math.floor(random() * (i + 1));
                [questions[i], questions[j]] = [questions[j], questions[i]];
            }
        }

        let currentQuestion = 0;
        let correctAnswers = 0;
        let hardCorrect = 0;
        let mediumCorrect = 0;
        let easyCorrect = 0;
        let hardTotal = 0;
        let mediumTotal = 0;
        let easyTotal = 0;
        let answerSelected = false;
        let quizComplete = false;

        // URL deep linking functions
        function updateURL() {
            const params = new URLSearchParams();
            if (quizComplete) {
                params.set('complete', 'true');
            } else {
                params.set('question', currentQuestion + 1); // 1-indexed for user-friendly URLs
            }
            const newURL = `${window.location.pathname}?${params.toString()}`;
            window.history.pushState({ question: currentQuestion }, '', newURL);
        }

        function getQuestionFromURL() {
            const params = new URLSearchParams(window.location.search);
            const questionParam = params.get('question');
            if (questionParam) {
                const questionNum = parseInt(questionParam, 10) - 1; // Convert to 0-indexed
                if (questionNum >= 0 && questionNum < questions.length) {
                    return questionNum;
                }
            }
            return 0;
        }

        // Handle browser back/forward buttons
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.question !== undefined) {
                currentQuestion = event.state.question;
                answerSelected = false;
                showQuestion();
            }
        });

        function showQuestion() {
            if (currentQuestion >= questions.length) {
                showResults();
                return;
            }

            // Update URL with current question
            updateURL();

            const q = questions[currentQuestion];
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;

            let difficultyBadge = '';
            if (q.difficulty === 'easy') {
                difficultyBadge = '<span class="difficulty-badge difficulty-easy">Easy</span>';
            } else if (q.difficulty === 'medium') {
                difficultyBadge = '<span class="difficulty-badge difficulty-medium">Medium</span>';
            } else {
                difficultyBadge = '<span class="difficulty-badge difficulty-hard">Hard</span>';
            }

            let optionsHTML = q.options.map((opt, i) => {
                const letter = String.fromCharCode(65 + i); // A, B, C, D, E, F
                return `<div class="option" data-index="${i}" onclick="selectAnswer(${i})">${letter}) ${opt}</div>`;
            }).join('');

            document.getElementById('quizContent').innerHTML = `
                <div class="question-number">
                    Question ${currentQuestion + 1} of ${questions.length}
                    ${difficultyBadge}
                </div>
                <div class="question">${q.question}</div>
                <div class="options">${optionsHTML}</div>
            `;

            answerSelected = false;
        }

        function showPopup() {
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';

            const popup = document.createElement('div');
            popup.className = 'popup-modal';
            popup.innerHTML = `
                <div class="popup-close">√ó</div>
                <div class="emoji">üíä</div>
                <h3>TAKE YOUR MEDS!</h3>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(popup);

            // Close popup when X button is clicked
            const closeBtn = popup.querySelector('.popup-close');
            closeBtn.onclick = () => {
                overlay.remove();
                popup.remove();
            };

            // Also close when clicking overlay
            overlay.onclick = () => {
                overlay.remove();
                popup.remove();
            };
        }

        function showCorrectPopup() {
            const overlay = document.createElement('div');
            overlay.className = 'popup-overlay';

            const popup = document.createElement('div');
            popup.className = 'popup-modal popup-correct';
            popup.innerHTML = `
                <div class="popup-close">√ó</div>
                <div class="emoji">üíâ</div>
                <h3>GIVE YOUR MEDS TO A PATIENT OF YOUR CHOICE!</h3>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(popup);

            // Close popup when X button is clicked
            const closeBtn = popup.querySelector('.popup-close');
            closeBtn.onclick = () => {
                overlay.remove();
                popup.remove();
            };

            // Also close when clicking overlay
            overlay.onclick = () => {
                overlay.remove();
                popup.remove();
            };
        }

        function selectAnswer(index) {
            if (answerSelected) return;
            answerSelected = true;

            const q = questions[currentQuestion];
            const options = document.querySelectorAll('.option');
            
            // Disable all options
            options.forEach(opt => opt.classList.add('disabled'));
            
            if (index === q.correct) {
                // Correct answer
                options[index].classList.add('correct');
                correctAnswers++;
                playSuccess();
                showCorrectPopup();
                
                if (q.difficulty === 'easy') {
                    easyCorrect++;
                } else if (q.difficulty === 'medium') {
                    mediumCorrect++;
                } else {
                    hardCorrect++;
                }
            } else {
                // Wrong answer
                options[index].classList.add('incorrect');
                options[q.correct].classList.add('correct');
                playBuzzer();
                showPopup();
            }
            
            // Track totals
            if (q.difficulty === 'easy') {
                easyTotal++;
            } else if (q.difficulty === 'medium') {
                mediumTotal++;
            } else {
                hardTotal++;
            }

            // Show explanation
            const answerHTML = `
                <div class="answer-reveal">
                    <div class="answer-label">Explanation</div>
                    <div class="answer-text">${q.explanation}</div>
                </div>
                <div class="click-hint">Click anywhere to continue to next question...</div>
            `;

            document.getElementById('quizContent').insertAdjacentHTML('beforeend', answerHTML);
            
            // Add click handler to advance to next question
            setTimeout(() => {
                document.getElementById('quizContainer').style.cursor = 'pointer';
                document.getElementById('quizContainer').onclick = () => {
                    document.getElementById('quizContainer').onclick = null;
                    document.getElementById('quizContainer').style.cursor = 'default';
                    nextQuestion();
                };
            }, 500);
        }

        function nextQuestion() {
            currentQuestion++;
            showQuestion();
        }

        function showResults() {
            quizComplete = true;

            // Update URL to show completion
            updateURL();

            const totalScore = Math.round((correctAnswers / questions.length) * 100);
            const hardScore = hardTotal > 0 ? Math.round((hardCorrect / hardTotal) * 100) : 0;
            const mediumScore = mediumTotal > 0 ? Math.round((mediumCorrect / mediumTotal) * 100) : 0;
            const easyScore = easyTotal > 0 ? Math.round((easyCorrect / easyTotal) * 100) : 0;

            document.getElementById('quizContent').innerHTML = `
                <div class="quiz-complete">
                    <h2>üíÄ Quiz Complete! üíÄ</h2>
                    <div class="score">${totalScore}%</div>
                    <div class="score-breakdown">
                        <div class="score-item">
                            <div class="score-label">Easy Questions</div>
                            <div class="score-value">${easyCorrect}/${easyTotal}</div>
                        </div>
                        <div class="score-item">
                            <div class="score-label">Medium Questions</div>
                            <div class="score-value">${mediumCorrect}/${mediumTotal}</div>
                        </div>
                        <div class="score-item">
                            <div class="score-label">Hard Questions</div>
                            <div class="score-value">${hardCorrect}/${hardTotal}</div>
                        </div>
                    </div>
                    <p style="color: #ff9500; margin-bottom: 30px;">You survived ${correctAnswers} out of ${questions.length} nightmare questions! üéÉ</p>
                    <button class="restart-btn" onclick="restartQuiz()">Rise Again üßü</button>
                </div>
            `;
        }

        function restartQuiz() {
            currentQuestion = 0;
            correctAnswers = 0;
            hardCorrect = 0;
            mediumCorrect = 0;
            easyCorrect = 0;
            hardTotal = 0;
            mediumTotal = 0;
            easyTotal = 0;
            quizComplete = false;
            initializeQuestions();
            showQuestion();
        }

        // Initialize audio on first user interaction (required for iOS)
        function enableAudioOnFirstInteraction() {
            initAudio();
            // Remove listeners after first interaction
            document.removeEventListener('touchstart', enableAudioOnFirstInteraction);
            document.removeEventListener('click', enableAudioOnFirstInteraction);
        }

        // Add listeners for first user interaction
        document.addEventListener('touchstart', enableAudioOnFirstInteraction, { passive: true });
        document.addEventListener('click', enableAudioOnFirstInteraction);

        // Initialize quiz
        initializeQuestions();

        // Check if there's a question in the URL and start from there
        const urlQuestion = getQuestionFromURL();
        if (urlQuestion > 0) {
            currentQuestion = urlQuestion;
        }

        showQuestion();
    </script>
</body>
</html>